repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.6.0
    hooks:
      - id: trailing-whitespace
        args: [--markdown-linebreak-ext=md]
      - id: end-of-file-fixer
      - id: check-yaml
        args: [--allow-multiple-documents]
      - id: check-added-large-files
      - id: check-case-conflict
      - id: check-merge-conflict
      - id: check-executables-have-shebangs
      - id: check-json
      - id: detect-private-key
        exclude: ^(examples/.*\.yaml)$

  - repo: https://github.com/golangci/golangci-lint
    rev: v1.61.0
    hooks:
      - id: golangci-lint
        args: [--timeout=5m]

  - repo: https://github.com/tekwizely/pre-commit-golang
    rev: v1.0.0-rc.1
    hooks:
      - id: go-fmt
      - id: go-imports
      - id: go-vet-mod
      - id: go-mod-tidy

  - repo: https://github.com/adrienverge/yamllint
    rev: v1.35.1
    hooks:
      - id: yamllint
        args: [-c=.yamllint.yaml]

  - repo: https://github.com/igorshubovych/markdownlint-cli
    rev: v0.41.0
    hooks:
      - id: markdownlint
        args: [--config=.markdownlint.yaml]

  - repo: https://github.com/hadolint/hadolint
    rev: v2.12.0
    hooks:
      - id: hadolint-docker
        args: [--ignore=DL3008, --ignore=DL3009]

  - repo: local
    hooks:
      - id: go-generate
        name: go generate
        entry: make generate
        language: system
        files: \.go$
        pass_filenames: false

      - id: go-test
        name: go test
        entry: make test
        language: system
        files: \.go$
        pass_filenames: false

      - id: no-commit-secrets
        name: Check for secrets
        entry: |
          python3 -c "
          import sys
          import re

          secret_patterns = [
              r'(?i)(password|passwd|pwd)\s*[=:]\s*[\"\']\w+[\"\']\s*',
              r'(?i)(api[_-]?key|apikey)\s*[=:]\s*[\"\']\w+[\"\']\s*',
              r'(?i)(secret[_-]?key|secretkey)\s*[=:]\s*[\"\']\w+[\"\']\s*',
              r'(?i)(access[_-]?token|accesstoken)\s*[=:]\s*[\"\']\w+[\"\']\s*',
              r'(?i)(auth[_-]?token|authtoken)\s*[=:]\s*[\"\']\w+[\"\']\s*',
              r'(?i)(namecheap[_-]?token|namecheap[_-]?key)\s*[=:]\s*[\"\']\w+[\"\']\s*',
          ]

          for filename in sys.argv[1:]:
              try:
                  with open(filename, 'r', encoding='utf-8', errors='ignore') as f:
                      content = f.read()
                      for pattern in secret_patterns:
                          if re.search(pattern, content):
                              print(f'Potential secret found in {filename}')
                              sys.exit(1)
              except Exception:
                  pass
          "
        language: system
        files: \.(go|yaml|yml|json|md|sh|env)$
        exclude: ^(examples/.*\.yaml)$